<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sicau.dao.TeamMapper">
  <resultMap id="BaseResultMap" type="com.sicau.entity.dto.Team">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Feb 01 16:05:07 CST 2019.
    -->
    <id column="team_id" jdbcType="VARCHAR" property="teamId" />
    <result column="team_name" jdbcType="VARCHAR" property="teamName" />
    <result column="direction" jdbcType="VARCHAR" property="direction" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="create_time" jdbcType="VARCHAR" property="createTime" />
    <result column="team_state" jdbcType="VARCHAR" property="teamState" />
    <result column="team_score" jdbcType="VARCHAR" property="teamScore" />
    <result column="number" jdbcType="VARCHAR" property="number" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Feb 01 16:05:07 CST 2019.
    -->
    delete from team
    where team_id = #{teamId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.sicau.entity.dto.Team">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Feb 01 16:05:07 CST 2019.
    -->
    insert into team (team_id, team_name, direction, 
      description, create_time, team_state, 
      team_score, number)
    values (#{teamId,jdbcType=VARCHAR}, #{teamName,jdbcType=VARCHAR}, #{direction,jdbcType=VARCHAR}, 
      #{description,jdbcType=VARCHAR}, #{createTime,jdbcType=VARCHAR}, #{teamState,jdbcType=VARCHAR}, 
      #{teamScore,jdbcType=VARCHAR}, #{number,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.sicau.entity.dto.Team">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Feb 01 16:05:07 CST 2019.
    -->
    update team
    set team_name = #{teamName,jdbcType=VARCHAR},
      direction = #{direction,jdbcType=VARCHAR},
      description = #{description,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=VARCHAR},
      team_state = #{teamState,jdbcType=VARCHAR},
      team_score = #{teamScore,jdbcType=VARCHAR},
      number = #{number,jdbcType=VARCHAR}
    where team_id = #{teamId,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Feb 01 16:05:07 CST 2019.
    -->
    select team_id, team_name, direction, description, create_time, team_state, team_score, 
    number
    from team
    where team_id = #{teamId,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Feb 01 16:05:07 CST 2019.
    -->
    select team_id, team_name, direction, description, create_time, team_state, team_score, 
    number
    from team
  </select>
  <select id = "selectAuditedTeam" resultMap = "auditedTeam">
      SELECT
          -- 团队信息
          t.team_id, t.team_name, t.direction,
          -- 队长信息
          cap.name captainName,
          cap.direction captainDirection,
          cap.major captainMajor,
          cap.department captainDepartment,
          cap.grade captainGrade,
          cap.sex captainSex,
          cap.description captainDescription,
          cap.tel_number captainTelNumber,
          -- 队员信息
          memberPO.name memberName,
          memberPO.direction memberDirection,
          memberPO.major memberMajor,
          memberPO.department memberDepartment,
          memberPO.grade memberGrade,
          memberPO.sex memberSex,
          memberPO.description memberDescription,
          memberPO.tel_number memberTelNumber
      FROM team t, teamAndUser tau, user cap, user memberPO
      WHERE
        -- 查询待审核团队条件
          t.team_state = "1" AND
        -- 查询队长条件
          (tau.team_id = t.team_id AND cap.user_id = tau.captain)
        -- 查询成员条件
        AND (tau.team_id = t.team_id AND memberPO.user_id = tau.member)
  </select>
  <resultMap type="com.sicau.entity.pojo.po.AuditedTeamPO" id="auditedTeam">
  	<id column = "team_id" property = "team.teamId"></id>
  	<result column = "team_name" property = "team.teamName"></result>
  	<result column = "direction" property = "team.direction"></result>
  	<result column = "captainName" property = "captain.name"></result>
  	<result column = "captainDirection" property = "captain.direction"></result>
  	<result column = "captainMajor" property = "captain.major"></result>
  	<result column = "captainDepartment" property = "captain.department"></result>
  	<result column = "captainGrade" property = "captain.grade"></result>
  	<result column = "captainSex" property = "captain.sex"></result>
  	<result column = "captainDescription" property = "captain.description"></result>
    <result column = "captainTelNumber" property = "captain.telNumber"></result>
  	<result column = "memberName" property = "memberPO.name"></result>
  	<result column = "memberDirection" property = "memberPO.direction"></result>
  	<result column = "memberMajor" property = "memberPO.major"></result>
  	<result column = "memberDepartment" property = "memberPO.department"></result>
  	<result column = "memberGrade" property = "memberPO.grade"></result>
  	<result column = "memberDepartment" property = "memberPO.department"></result>
  	<result column = "memberSex" property = "memberPO.sex"></result>
  	<result column = "memberDescription" property = "memberPO.description"></result>
    <result column = "memberTelNumber" property = "memberPO.telNumber"></result>
  </resultMap>
    <select id="getTeam" resultMap="BaseResultMap">
    select * from team where team_id= #{teamId}
  </select>
    <update id="updateScore">
    update team set team_score=#{score} where team_id=#{teamId}
  </update>

    <update id="updateStateTeam">
        update team set team_state = #{state} where team_id = #{teamId}
    </update>

    <select id="selectTeamById" resultType="com.sicau.entity.dto.Team">
        select * from team where team_id = #{teamId}
    </select>

</mapper>